system sh/stop_dnodes.sh
system sh/deploy.sh -n dnode1 -i 1
system sh/exec.sh -n dnode1 -s start
sql connect
sql drop database if exists test
sql create database test;
sql use test;

sql create table st(ts timestamp, f int) tags (t int);
sql insert into ct1 using st tags(1) values(now, 1);
sql insert into ct2 using st tags(2) values(now, 2);
sql insert into ct3 using st tags(3) values(now, 3);
sql insert into ct4 using st tags(4) values(now, 4);

sql create table st2(ts timestamp, f int) tags (t int);
sql insert into ct21 using st2 tags(1) values(now, 1);
sql insert into ct22 using st2 tags(2) values(now, 2);
sql insert into ct23 using st2 tags(3) values(now, 3);
sql insert into ct24 using st2 tags(4) values(now, 4);

sql create view view1 as select * from st;
sql drop view view1;

sql create or replace view view2 as select f from ct1;
sql drop view if exists view2;
sql drop view if exists view3;
sql_error drop view view2;
sql_error drop view view3;

sql create view view3 as select avg(f) from st2;
sql create or replace view view3 as select f fa from st;
sql_error create view view3 as select * from st2;
sql create view view4 as select * from view3;
sql create or replace view view4 as select fa from view3;
sql drop view view3;
sql_error create view view5 as select * from view3;
sql drop view view4;

system sh/exec.sh -n dnode1 -s stop -x SIGINT
