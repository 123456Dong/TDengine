sql connect
sql use test0;

sql select a.ts, a.col1, b.ts, b.col1 from sta a left join sta b on timetruncate(a.ts, 1h) = timetruncate(b.ts, 1h);
if $rows != 64 then
  return -1
endi

sql select a.ts, a.col1, b.ts, b.col1 from sta a join sta b on timetruncate(a.ts, 1h) = timetruncate(b.ts, 1h);
if $rows != 64 then
  return -1
endi

sql select a.ts, a.col1, b.ts, b.col1 from sta a join sta b on timetruncate(a.ts, 1h) = timetruncate(b.ts, 1h) and a.col1=b.col1;
if $rows != 12 then
  return -1
endi

sql select a.ts, a.col1, b.ts, b.col1 from sta a join sta b on timetruncate(a.ts, 1m) = b.ts;
if $rows != 16 then
  return -1
endi

sql select a.ts, b.col1 from sta a left join sta b on timetruncate(b.ts, 1h) = a.ts;
if $rows != 8 then
  return -1
endi

sql select a.ts, b.col1,timetruncate(a.col1, 1h) from sta a left join sta b on a.ts = b.ts and timetruncate(a.col1, 1h) = timetruncate(a.col1, 1h);
if $rows != 12 then
  return -1
endi

sql select a.ts, b.col1 from sta a left semi join sta b on timetruncate(a.ts, 1h) = timetruncate(b.ts, 1h);
if $rows != 8 then
  return -1
endi

sql select a.ts, b.col1 from sta a left anti join sta b on timetruncate(a.ts, 1h) = timetruncate(b.ts, 1h);
if $rows != 0 then
  return -1
endi

sql select a.ts, b.col1 from sta a left asof join sta b on timetruncate(a.ts, 1h) > timetruncate(b.ts, 1h);
if $rows != 8 then
  return -1
endi
sql select a.ts, b.col1 from sta a left asof join sta b on timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h) jlimit 2;
if $rows != 16 then
  return -1
endi
sql select a.ts, b.col1 from sta a left asof join sta b on timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h) jlimit 8;
if $rows != 64 then
  return -1
endi
sql select a.ts, b.col1 from sta a left asof join sta b on timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h) jlimit 9;
if $rows != 64 then
  return -1
endi

sql select a.ts, b.ts from sta a left asof join sta b on a.col1 =b.col1 and timetruncate(a.ts, 1h) > timetruncate(b.ts, 1h) jlimit 2;
if $rows != 8 then
  return -1
endi

sql select a.ts, b.ts from sta a left asof join sta b on timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h) jlimit 2 where timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h);
if $rows != 16 then
  return -1
endi

sql_error select a.ts, b.ts from sta a left asof join sta b on a.ts=b.ts and a.ts=b.ts;
sql_error select a.ts, b.ts from sta a left asof join sta b on timetruncate(a.ts, 1h) > timetruncate(b.ts, 1h) and timetruncate(a.ts, 1h) > timetruncate(b.ts, 1h);
sql_error select a.ts, b.ts from sta a left asof join sta b on timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h) and a.ts > timetruncate(b.ts, 1s) jlimit 2;
sql_error select a.ts, b.ts from sta a left asof join sta b on a.ts > timetruncate(b.ts, 1s) and timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h) jlimit 2;
sql_error select a.ts, b.ts from sta a left asof join sta b on timetruncate(a.ts, 1h) >= timetruncate(b.ts, 1h) and a.ts =b.col1 jlimit 2;
sql_error select a.ts, b.col1 from sta a left join sta b on timetruncate(b.ts, 1h) + 1 = a.ts;
sql_error select a.ts, b.col1 from sta a left join sta b on timetruncate(b.ts, 1h) = a.ts + 1;
sql_error select a.ts, b.col1 from sta a left join sta b on b.ts + 1 = a.ts + 1;

sql use testa;

sql select sta1.ts, sta2.ts from sta1 full join sta2 on timetruncate(sta1.ts, 1a) = timetruncate(sta2.ts, 1a);
if $rows != 8 then
  return -1
endi
if $data00 != @23-10-16 09:10:11.001@ then
  return -1
endi
if $data01 != NULL then
  return -1
endi
if $data10 != NULL then
  return -1
endi
if $data11 != @23-10-16 09:10:11.002@ then
  return -1
endi

sql select sta1.ts, sta2.ts from sta1 full join sta2 on timetruncate(sta1.ts, 1a) = timetruncate(sta2.ts, 1a) and sta1.ts=sta2.ts;
if $rows != 8 then
  return -1
endi

sql select sta1.ts, sta2.ts from sta1 full join sta2 on timetruncate(sta1.ts, 1s) = timetruncate(sta2.ts, 1s);
if $rows != 4 then
  return -1
endi
sql select sta1.ts, sta2.ts from sta1 full join sta2 on timetruncate(sta1.ts, 1m) = timetruncate(sta2.ts, 1m);
if $rows != 16 then
  return -1
endi
sql select sta1.ts, sta2.ts from sta1 full join sta2 on timetruncate(sta1.ts, 1h) = timetruncate(sta2.ts, 1h) order by timetruncate(sta1.ts, 1s) desc, timetruncate(sta2.ts, 1s);
if $rows != 16 then
  return -1
endi
if $data00 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data01 != @23-10-16 09:10:11.002@ then
  return -1
endi

sql select sta1.ts, sta2.ts from sta1 full join sta2 on timetruncate(sta1.ts, 1h) = timetruncate(sta2.ts, 1h, 0) order by timetruncate(sta1.ts, 1s) desc, timetruncate(sta2.ts, 1s);
if $rows != 16 then
  return -1
endi
if $data00 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data01 != @23-10-16 09:10:11.002@ then
  return -1
endi
sql select sta1.ts, sta2.ts from sta1 full join sta2 on timetruncate(sta1.ts, 1d) = timetruncate(sta2.ts, 1d, 0) order by timetruncate(sta1.ts, 1s) desc, timetruncate(sta2.ts, 1s);
if $rows != 8 then
  return -1
endi
if $data00 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data01 != NULL then
  return -1
endi
sql select sta1.ts,timetruncate(sta1.ts, 1d), sta2.ts, timetruncate(sta2.ts, 1d, 0) from sta1 left asof join sta2 on timetruncate(sta1.ts, 1d) >= timetruncate(sta2.ts, 1d, 0) order by timetruncate(sta1.ts, 1s) desc, timetruncate(sta2.ts, 1s);
if $rows != 4 then
  return -1
endi
if $data00 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data02 != NULL then
  return -1
endi
if $data10 != @23-10-16 09:10:13.001@ then
  return -1
endi
if $data12 != NULL then
  return -1
endi
sql select sta1.ts,timetruncate(sta1.ts, 1d, 0), sta2.ts, timetruncate(sta2.ts, 1d, 1) from sta1 left asof join sta2 on timetruncate(sta1.ts, 1d, 0) >= timetruncate(sta2.ts, 1d, 1) jlimit 4 order by timetruncate(sta1.ts, 1s) desc, timetruncate(sta2.ts, 1s);
if $rows != 16 then
  return -1
endi
if $data00 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data02 != @23-10-16 09:10:11.002@ then
  return -1
endi
if $data10 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data12 != @23-10-16 09:10:12.002@ then
  return -1
endi
sql select sta1.ts, sta2.ts from sta1 left asof join sta2 on timetruncate(sta1.ts, 1s, 0) > timetruncate(sta2.ts, 1s, 1) jlimit 4 order by timetruncate(sta1.ts, 1s) desc, timetruncate(sta2.ts, 1s);
if $rows != 7 then
  return -1
endi
if $data00 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data01 != @23-10-16 09:10:11.002@ then
  return -1
endi
if $data10 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data11 != @23-10-16 09:10:12.002@ then
  return -1
endi
if $data20 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data21 != @23-10-16 09:10:13.002@ then
  return -1
endi
if $data30 != @23-10-16 09:10:13.001@ then
  return -1
endi
if $data31 != @23-10-16 09:10:11.002@ then
  return -1
endi
if $data40 != @23-10-16 09:10:13.001@ then
  return -1
endi
if $data41 != @23-10-16 09:10:12.002@ then
  return -1
endi
if $data50 != @23-10-16 09:10:12.001@ then
  return -1
endi
if $data51 != @23-10-16 09:10:11.002@ then
  return -1
endi
if $data60 != @23-10-16 09:10:11.001@ then
  return -1
endi
if $data61 != NULL then
  return -1
endi

sql select sta1.ts,timetruncate(sta1.ts, 1w, 0), sta2.ts,timetruncate(sta2.ts, 1w, 1) from sta1 left asof join sta2 on timetruncate(sta1.ts, 1w, 0) > timetruncate(sta2.ts, 1w, 1) jlimit 4 order by timetruncate(sta1.ts, 1s) desc, timetruncate(sta2.ts, 1s);
if $rows != 16 then
  return -1
endi
if $data00 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data02 != @23-10-16 09:10:11.002@ then
  return -1
endi
if $data10 != @23-10-16 09:10:14.001@ then
  return -1
endi
if $data12 != @23-10-16 09:10:12.002@ then
  return -1
endi


sql_error select count(*) from sta1 left window join sta2 on timetruncate(sta1.ts, 1h) = timetruncate(sta2.ts, 1h) window_offset(-1s, 1s);
