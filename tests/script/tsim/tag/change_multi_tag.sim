system sh/stop_dnodes.sh
system sh/deploy.sh -n dnode1 -i 1
system sh/exec.sh -n dnode1 -s start
sql connect

print ======================== dnode1 start

$dbPrefix = ta_ad_db
$tbPrefix = ta_ad_tb
$mtPrefix = ta_ad_mt
$tbNum = 10
$rowNum = 20
$totalNum = 200

print =============== step1
$i = 0
$db = $dbPrefix . $i

sql create database $db
sql use $db

print =============== step2
$j = 3
$i = 2
$mt = $mtPrefix . $i
$tb = $tbPrefix . $i
$tbj = $tbPrefix . $j
$ntable = tb_normal_table

sql create table $mt (ts timestamp, tbcol int) TAGS(tagCol1 bool, tagCol2 tinyint, tagCol3 smallint, tagCol4 int, tagCol5 bigint, tagCol6 nchar(10), tagCol7 binary(8))
sql create table $tb using $mt tags( 1, 2, 3, 5,7, "test", "test")
sql create table $tbj using $mt tags( 2, 3, 4, 6,8, "testj", "testj")
sql create table $ntable (ts timestamp, f int)

sql insert into $tb values(now, 1)
sql insert into $tb values(now, 1)
sql_error alter table $mt set tag tgcol1 = 1,tagcol2 = 2, tag3 = 4 # set tag value on supertable
sql_error alter table $ntable set tag f = 10  # set normal table value
sql_error alter table $tbj set tag tagCol1=1,tagCol1 = 2 # dumplicate tag name
sql_error alter table $tbj set tag tagCol1=1,tagCol1 = 2 # not exist tag
sql_error alter table $tbj set tag tagCol1 = 1, tagCol5="xxxxxxxxxxxxxxxx" 
sql_error alter table $tbj set tag tagCol1 = 1, tagCol5="xxxxxxxxxxxxxxxx", tagCol7="yyyyyyyyyyyyyyyyyyyyyyyyy" 
sql_error alter table $tbj set tag tagCol1=1,tagCol5=10, tagCol1=3
sql_error alter table $tbj set tag tagCol5="xxxx"
sql alter table $tbj set tag tagCol1 = 100, tagCol2 = 100 

sql select * from $mt where tagCol2 = 100
if $rows != 0  then
  return -1
endi

sql select * from $mt where tagCol1 = 1
if $rows != 2  then
  return -1
endi

sql alter table $tbj set tag tagCol1=true,tagCol2=-1,tagcol3=-10, tagcol4=-100,tagcol5=-1000,tagCol6="empty",tagCol7="empty1"
sql alter table $tb set tag tagCol1=0

sql select * from $mt where tagCol1 = true 
if $rows != 0  then
  return -1
endi

sql select * from $mt where tagCol2 = -1 
if $rows != 0  then
  return -1
endi

sql select * from $mt where tagCol3 = -10 
if $rows != 0  then
  return -1
endi

sql select * from $mt where tagCol4 = -100 
if $rows != 0  then
  return -1
endi

sql select * from $mt where tagCol5 = -1000 
if $rows != 0  then
  return -1
endi


sql select * from $mt where tagCol6 = "empty" 
if $rows != 0  then
  return -1
endi

sql select * from $mt where tagCol6 = "empty1" 
if $rows != 0  then
  return -1
endi

sql insert into $tbj values (now, 1)

sql select * from $mt where tagCol1 = true 
if $rows != 1  then
  return -1
endi

sql select * from $mt where tagCol2 = -1 
if $rows != 1  then
  return -1
endi

sql select * from $mt where tagCol3 = -10 
if $rows != 1  then
  return -1
endi

sql select * from $mt where tagCol4 = -100 
if $rows != 1  then
  return -1
endi

sql select * from $mt where tagCol5 = -1000 
if $rows != 1  then
  return -1
endi


sql select * from $mt where tagCol6 = "empty" 
if $rows != 1  then
  return -1
endi

sql select * from $mt where tagCol7 = "empty1" 
if $rows != 1  then
  return -1
endi

system sh/exec.sh -n dnode1 -s stop -x SIGINT
